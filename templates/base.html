<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="{{url_for('static',filename='css/style.css')}}" rel="stylesheet">
    <title>Pr√©sentation de Fernando 2024</title>
    <style>


/* Container for the carousel */
.carousel-container {
  position: relative;
  width: 80vw;
  height: 80vh;
  margin: 100px auto;
  overflow: hidden;

  align-items: flex-start;
  transition: transform 0.5s ease;
  padding: 20px;
}
.carousel-subcontainer {
  padding-left: 20px;
  padding-right: 20px;
}
/* Individual card container */
.evocard-container {
  position: absolute;
  width: 300px;
  height: 400px;
  transform-origin: center;
  transition: opacity 0.3s, transform 0.5s ease;
  cursor: pointer;
}

/* Active card style */
.evocard-container.active {
  opacity: 1;
  z-index: 2;
}

/* Inactive card style (with reduced opacity) */
.evocard-container:not(.active) {
  opacity: 0.4;
  z-index: 1;
}

/* The flip effect (front and back) */
.evocard {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  transform-style: preserve-3d;
  transition: transform 0.6s;
}

.evocard-front, .evocard-back {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  padding: 20px;
  border-radius: 10px;
}

/* Front side styling */
.evocard-front {
  background-color: #f0f0f0;
}

/* Back side styling */
.evocard-back {
  background-color: #3b5998;
  color: white;
  transform: rotateY(180deg);
}

.evocard.flipped {
  transform: rotateY(180deg);
}

/* Navigation arrows */
.nav-arrow {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background-color: rgba(0, 0, 0, 0.5);
  color: black !important; 
  border: none;
  font-size: 30px;
  padding: 10px;
  cursor: pointer;
  font-weight: bold; 
}

.nav-arrow.prev {
  left: 0;
 
}

.nav-arrow.next {
  right: 0;

}
/* Make the text "Previous" and "Next" black */
.carousel-control-prev,
.carousel-control-next {
  color: black; /* Set the text color to black */
  font-weight: bold; /* Optionally, make the text bold */
}
.carousel-control-prev-icon,
.carousel-control-next-icon {
  background-color: grey !important; /* Ensure the color overrides the default */
  border-radius: 50%; /* Optional: round the icon */
  width: 15px; /* Adjust width */
  height: 15px; /* Adjust height */
  margin:5px;
}






.profile-card {
      background-color: #f4f4f4;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .profile-card img {
      border-radius: 50%;
      width: 100px;
      height: 100px;
    }

    .articles {
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }

    .articles ul {
      list-style: none;
      padding: 0;
    }

    .articles li {
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #ddd;
    }

    .articles li:last-child {
      border-bottom: none;
    }

    .articles a {
      text-decoration: none;
      color: #333;
      font-weight: bold;
    }

    .articles a:hover {
      color: #007bff;
    }




/* Background images container */
.background-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 1500px;
      background-size: 100% auto; /* Stretch to fit width, auto height */
      background-repeat: repeat-y !important; /* Repeat vertically */
      background-position: top;
      animation: changeBackground 8s infinite;
      filter: opacity(0.2);
      background-attachment: fixed;
    }
@keyframes changeBackground {
  0% { background-image: url('{{ url_for("static", filename="images/1.jpg") }}'); }
  33.33% { background-image: url('{{ url_for("static", filename="images/2.jpg") }}'); }
  66.66% { background-image: url('{{ url_for("static", filename="images/3.jpg") }}'); }
  100% { background-image: url('{{ url_for("static", filename="images/1.jpg") }}'); }
}
/* Add smooth transitions to content */
.othercontent {
      z-index: 1;
      position: relative;
      padding: 0 20%; /* Removes padding on all sides */
            margin: 0;  /* Removes default margin */
            width: 100%; /* Ensures full width */
    }

    .navbar {
  position: relative;  /* Ensure the wave is positioned relative to the navbar */
  z-index: 10;         /* Make sure the navbar is above the wave */
}

/* Custom Button Styling */
.custom-btn {
    width: 70%; /* Occupy 70% of the container */
    margin: 0 auto; /* Center horizontally */
    background-color: #f5f5f5; /* Greyish white */
    color: #333; /* Dark text color */
    border: none; /* No border */
    padding: 10px 20px;
    font-size: 1rem;
    text-align: center;
    position: relative; /* Needed for pseudo-elements */
    overflow: hidden; /* Hide animation overflow */
    border-radius: 5px; /* Rounded corners */
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Subtle shadow */
    transition: all 0.3s ease; /* Smooth transitions */
    cursor: pointer; 
}

/* Hover and focus effects */
.custom-btn:hover {
    background-color: #eaeaea; /* Slightly darker grey on hover */
    box-shadow: 0 8px 12px rgba(0, 0, 0, 0.2); /* Bigger shadow on hover */
    transform: scale(1.05);
}

/* Pseudo-element for border animation */
.custom-btn::before {
    content: "";
    position: absolute;
    top: 0;
    left: 50%; /* Start from the center */
    height: 100%;
    width: 0%; /* Start with zero width */
    z-index: 1;
    transition: all 0.4s ease; /* Smooth width expansion */
}

/* Animation on hover */
.custom-btn:hover::before {
    left: 0; /* Expand from left edge */
    width: 100%; /* Expand to full width */
    opacity: 0; /* Fade out after expansion */
    transition: width 0.4s ease, opacity 0.2s ease 0.4s; /* Smooth transition */
}

/* Ensure content is on top */
.custom-btn span {
    position: relative; /* Bring text on top */
    z-index: 2;
}


.post-title-link {
    color: black;               /* Make the text black */
    font-weight: bold;          /* Make the text bold */
    text-decoration: none;      /* Remove underline */
    cursor: pointer;           /* Change cursor to pointer on hover */
  }

  .post-title-link:hover {
    text-decoration: none;      /* Ensure no underline on hover */
  }

  .d-flex {
    display: flex;
  }

  .justify-content-end {
    justify-content: flex-end;
  }
  .post-title-link:hover {
  text-decoration: none;      /* Ensure no underline on hover */
}
/* Custom Modal Styles */
.custom-modal {
 /* Hidden by default */
  position: fixed;
  z-index: 1050; /* High z-index to be on top */
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.4); /* Black background with opacity */
}

.custom-modal-content {
  background-color: #fff;
  margin: 3% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 90%;
  max-width: 900px;
  overflow-y: auto; /* Scrollable if the content exceeds max-height */
  z-index: 1060; /* Ensure the modal content is on top of the overlay */
}
/* Modal Header */
.modal-header {
  display: flex;              /* Use Flexbox to align the title and close button on the same line */
  justify-content: space-between; /* Ensures space between the title and the close button */
  align-items: center;        /* Vertically centers the title and close button */
  width: 100%;                /* Ensure header takes up full width */
}

.modal-title {
  margin: 0;                  /* Remove any default margin */
  flex-grow: 1;               /* Ensures the title takes up the available space */
}


.custom-close2 {
  color: #aaa;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}

.custom-close2:hover,
.custom-close2:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}



  /* Ensure the container takes the full viewport height */
  .full-screen-center {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh; /* Full viewport height */
    text-align: center;
    padding:0 200px ;
}

/* Optional: Add padding or margin adjustments for better spacing */
.full-screen-center h4 {
    margin-bottom: 1rem;
}

.full-screen-center a {
    display: inline-block;
    margin-top: 1rem; /* Adjust spacing between text and the link */
}

/* Ensure the button has a transparent background and outline by default */
.btn-outline-primary2 {
  color: #007bff;  /* Set the default text color */
  background-color: transparent;  /* Transparent background */
  border-color: #007bff;  /* Outline color */
}

/* On hover, change the background to blue and text to white */
.btn-outline-primary2:hover {
  color: white;  /* Text turns white on hover */
  background-color: #007bff;  /* Background turns blue on hover */
  border-color: #007bff;  /* Maintain the blue border */
}         

/* Chatbox Styles */
.chatbox {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 500px;
    max-height: 800px;
    background-color: white;
    border: 1px solid #ccc;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    z-index: 9999;
}

.chatbox-header {
    padding: 10px;
    background-color: #007bff;
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.chatbox-header h5 {
    margin: 0;
}

.chatbox {
    padding: 10px;
    max-height: 600px;
    overflow-y: auto;
}

.chatbox .chat-input {
    padding: 10px;
    background-color: #f9f9f9;
}

.chatbox .btn-close {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
}

.chatbox .btn-close:hover {
    color: #f1f1f1;
}

#close-chatbox {
  display: block; /* Ensure it's not set to none */
  visibility: visible; /* Ensure it's not set to hidden */
  opacity: 1; /* Ensure it's not fully transparent */
  z-index: 99999;
}


.chat-history {
  padding: 10px;
  overflow-y: scroll;
  height: 300px;
}
.chat-message {
  display: flex;
  flex-direction: column;
  margin-bottom: 15px;
}
.chat-message.sent {
  align-items: flex-end;
}
.chat-message.received {
  align-items: flex-start;
}
.message-content {
  max-width: 80%;
  background-color: #e9ecef;
  padding: 10px;
  border-radius: 5px;
  margin-bottom: 5px;
}
.message-time {
  font-size: 12px;
  color: #6c757d;
}

    </style>
  </head>
  <body>
    {% include 'navbar.html' %}
    <br/>
   <div class="background-overlay"></div>
    <div class="container-fluid othercontent">
        {% block content %}

        {% endblock %}
    </div>


<!-- Chatbox (Initially Hidden) -->
<div id="chatbox" class="chatbox" {% if session.get('chatUserId') %}
style="display: block;"  
{% else %}
style="display: none;"
{% endif %}>
  <div class="chatbox-header">
      <h5 id="chatbox-title">Chat with {{session.get('chatUserName')}}</h5>
      <button type="button" id="close-chatbox" class="btn-close">x</button>
  </div>
  <div id="chat-history" class="chat-history">
    {% if session.get('chat_history') %}
        {% for msg in session['chat_history'] %}
            <div class="chat-message {% if msg.sender_id == current_user.id %}sent{% else %}received{% endif %}">
                <div class="message-content">
                    <p>{{ msg.message_text }}</p>
                </div>
                <div class="message-time">
                    {% if msg.is_read %}
                        <small>Lu √†: {{ msg.read_at }}</small>
                    {% else %}
                        <small>Envoy√© √†: {{ msg.created_at  }}</small>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    {% endif %}
    <div id="loading" style="display: none; text-align: center;">Loading...</div> <!-- Loading indicator -->
 
  </div>

  <form  method="POST" class="chat-input">
    <textarea id="message-text" class="form-control" placeholder="√âcrivez ..." name="message" required></textarea>
    <input type="hidden" id="chat-user-id" name="chatUserId" value="{{ session.get('chatUserId') }}">
    <button id="send-message2" class="btn btn-primary mt-2" type="button">Envoyer</button>
</form>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.2/socket.io.min.js"></script>

<script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
          const overlay = document.querySelector(".background-overlay");
          const bodyHeight = document.body.scrollHeight; // Total height of the document
          overlay.style.height = `${bodyHeight}px`; // Set the height of the background
      });
  
      // Recalculate height on window resize
      window.addEventListener("resize", () => {
          const overlay = document.querySelector(".background-overlay");
          const bodyHeight = document.body.scrollHeight;
          overlay.style.height = `${bodyHeight}px`;
      });

      // Load more messages 
      const chatHistory = document.getElementById('chat-history');
      const loadingIndicator = document.getElementById('loading');
      
      // This script will be used to scroll the chat history to the bottom after a new message is added
      if (chatHistory) {
        chatHistory.scrollTop = chatHistory.scrollHeight; // Scroll to the bottom initially
      }

      // Close the chatbox when the 'x' button is clicked
      const closeButton = document.getElementById('close-chatbox');
      if (closeButton) {
        closeButton.addEventListener('click', async () => {
          document.getElementById('chatbox').style.display = 'none';
          await fetch('/clear_session', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            // You can send any necessary data here
          });
        });
      }

      // Handle the sending of messages (you may want to use AJAX for real-time updates)
      const messageTextArea = document.getElementById('message-text');
   

      const currentUserId = {{ current_user.id }};

      // Infinite scroll: Load more messages when the user scrolls to the top
      chatHistory.addEventListener('scroll', function() {
        //console.log(chatHistory.scrollTop)
        if (chatHistory.scrollTop === 0) {  // If scrolled to the top
          loadMoreMessages();
        }
      });
    
      // Load more messages (AJAX request to fetch messages from the server)
      function loadMoreMessages() {
        loadingIndicator.style.display = 'block';  // Show the loading indicator
    
        // Example of AJAX call to load more messages (adjust URL and logic as needed)
        fetch('/load_more_messages', { method: 'GET' })
          .then(response => response.json())
          .then(data => {
            if (data.messages) {
              messages.forEach(message => {
                const messageElement = document.createElement('div');
                messageElement.classList.add('chat-message');
                messageElement.classList.add(message.sender_id === currentUserId  ? 'sent' : 'received');
                
                messageElement.innerHTML = `
                    <div class="message-content">
                        <p>${message.message_text}</p>
                    </div>
                    <div class="message-time">
                        <small>${message.is_read ? 'Lu √†' : 'Envoy√© √†'}: ${message.is_read ? message.read_at : message.created_at}</small>
                    </div>
                `;

                // Prepend the message to the chat history
                chatHistory.insertBefore(messageElement, chatHistory.firstChild);
            });
            } else {
                console.error('Erreur: plus de messages.');
            }
          })
          .catch(error => {
            console.error('Erreur rencontr√©e en chargeant plus de messages:', error);
            
          });
          loadingIndicator.style.display = 'none';  // Hide the loading indicator on error
      }



      //socket
      var socket = io.connect('http://127.0.0.1:5000/'); 
      socket.on('receive_message', function(data) {
          if (data && (data.message[0].receiver_id == currentUserId || data.message[0].sender_id == currentUserId)) {
            var messageType = data.message[0].receiver_id == currentUserId ? 'received' : 'sent';
            var messageDiv = document.createElement('div');
            messageDiv.classList.add('chat-message', messageType);
            console.log("hello me here");
            // Create the message content
            var messageContent = document.createElement('div');
            messageContent.classList.add('message-content');
            messageContent.innerHTML = '<p>' + data.message[0].message_text + '</p>';
    
            // Create the message time
            var messageTime = document.createElement('div');
            messageTime.classList.add('message-time');
            if (data.message[0].is_read) {
                messageTime.innerHTML = '<small>Lu √†: ' + data.message[0].read_at + '</small>';
            } else {
                messageTime.innerHTML = '<small>Envoy√© √†: ' + data.message[0].created_at + '</small>';
            }
    
            // Append content and time to the message div
            messageDiv.appendChild(messageContent);
            messageDiv.appendChild(messageTime);
    
            // Append the new message to chat history
            document.getElementById('chat-history').appendChild(messageDiv);
            document.getElementById('chat-history').scrollTop = document.getElementById('chat-history').scrollHeight; // Scroll to the bottom
        }
      });



      socket.on('connect', function() {
        console.log('Socket connected!');
      });

      // Button click handler
      document.addEventListener('DOMContentLoaded', function() {

        const button = document.getElementById('send-message2');
        console.log(button);  // Check if this logs the button element
        if (button) {
          button.addEventListener('click', function() {
            console.log("click works");
            let mes = document.getElementById('message-text');
            const chatUserId = document.getElementById('chat-user-id').value;
            socket.emit('envoyer_msg', {
              'sender_id': currentUserId,
              'message': mes.value,
              'receiver_id': chatUserId
            });
            mes.value=''
          });
        } else {
          console.log("Button not found!");
        }
        console.log("socket button added");
      });

  </script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  </body>
</html>


<br/>

<footer class="bg-dark text-white pt-4 pb-4">
  <div class="container">
    <div class="row">
      <!-- Column 1 -->
      <div class="col-md-3">
        <h5>Anciens sites</h5>
        <ul class="list-unstyled">
          <li><a href="{{ g.sitephp +'projectaen.php' }}" class="text-white" target="_blank">Premier site</a></li>
          <li><a href="{{ g.sitephp +'t1.php' }}" class="text-white" target="_blank">Deuxi√®me site</a></li>
          <li><a href="{{ g.sitephp }}" class="text-white" target="_blank">Site en PHP</a></li>
          <li><a href="{{ g.sitevue }}"  class="text-white" target="_blank">Site en Vue</a></li>
        </ul>
      </div>

      <!-- Column 2 -->
      <div class="col-md-3">
        <h5>Services</h5>
        <ul class="list-unstyled">
          <li><a href="#" class="text-white">Pr√©vision QM</a></li>
          <li><a href="#" class="text-white">Projet de rapports</a></li>
          <li><a href="{{ g.sitephp +'t3.php' }}" class="text-white" target="_blank">Messenger</a></li>
          <li><a href="#" class="text-white">Apps</a></li>
        </ul>
      </div>

      <!-- Column 3 -->
      <div class="col-md-3">
        <h5>Support</h5>
        <ul class="list-unstyled">
          <li><a href="#" class="text-white">FAQ</a></li>
          <li><a href="#" class="text-white">Centre d'aide</a></li>
          <li><a href="#" class="text-white">Contact</a></li>
          <li><a href="#" class="text-white">Termes & conditions</a></li>
        </ul>
      </div>

      <!-- Column 4 -->
      <div class="col-md-3">
        <h5>M√©dias sociaux</h5>
        <ul class="list-unstyled d-flex">
          <li><a href="https://www.facebook.com/login" class="text-white mr-3" target="_blank"><i class="fab fa-facebook-f"></i></a></li>
          <li><a href="https://x.com/?lang=en" class="text-white mr-3" target="_blank"><i class="fab fa-twitter"></i></a></li>
          <li><a href="https://www.instagram.com/" class="text-white mr-3" target="_blank"><i class="fab fa-instagram"></i></a></li>
          <li><a href="https://www.linkedin.com/in/fernando-h-li-226175108/" class="text-white mr-3" target="_blank"><i class="fab fa-linkedin-in"></i></a></li>
          <li><a href="https://github.com/ErkinMehmet" class="text-white mr-3" target="_blank"><i class="fab fa-github"></i></a></li> <!-- Added GitHub link -->
        </ul>
      </div>
    </div>
    <hr class="border-light">
    <div class="text-center">
      <p class="mb-0">&copy; 2024 F√©d√©ration Qu√©b√©coise des Municipalit√©s</p>
    </div>
  </div>
</footer>